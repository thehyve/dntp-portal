<div class="container-fluid" ng-controller="LabRequestController">
    <div class="row">

        <!--Side Bar-->
        <div class="col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class="active"><a href="#/">View</a></li>
            </ul>
        </div>

        <div ng-show="!authenticated">
            <div class="alert alert-danger" role="alert">
                {{ 'Not logged in' | translate }}
            </div>
        </div>

        <div ng-if="!labRequest" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div ng-show="error" class="alert alert-danger" role="alert">
                {{ error | translate }}
            </div>
        </div>

        <!--Main-->
        <div ng-if="labRequest" class="col-md-10 col-md-offset-2 form-horizontal main">

            <h2 id="lab-request-title">
                {{labRequest.labRequestCode}}
            </h2>
            <br/>
            <hr>

            <div style="padding-bottom: 25px;">
                <button class="btn btn-default" type="button"  ng-click="edit(labRequest);" title="Actions"
                        ng-if="(isLabUser() && isLabUserStatus(labRequest.status))
                            || (isRequester() && isRequesterStatus(labRequest.status))"
                        ng-disabled="isLabUser() && (labRequest.assignee != globals.currentUser.userid)">
                    <span><i class="glyphicon glyphicon-pencil"></i></span>
                    {{'Actions' | translate}}
                </button>
                <button class="btn btn-default" type="button"  ng-click="focus('#noteText');" title="{{'Notes' | translate}}">
                    <span><i class="glyphicon glyphicon-comment"></i></span>
                    {{'Notes' | translate}}
                </button>
                 <span ng-if="labRequest.status != 'Waiting for lab approval' && labRequest.status != 'Rejected' && (isRequester() || isLabUser())">
                   <a class="btn btn-default" ng-href="/labrequests/{{labRequest.id}}/panumbers/csv">
                   <span><i class="glyphicon glyphicon-download-alt"></i></span>
                   Download panumbers_{{labRequest.id}}.csv
                   </a>
                 </span>
                <a href="mailto:{{labRequest.requesterEmail}}?subject=Lab request rejected&amp;body=Lab request rejected.%0AReject reason: {{labRequest.rejectReason}}
                    "
                    ng-if="labRequest.status=='Rejected' && isLabUser()">
                <button
                class="btn btn-default" type="button" title="{{'Compose rejection mail' | translate}}">
                    <span><i class="glyphicon glyphicon-envelope"></i></span>
                    {{'Compose rejection mail' | translate}}
                </button></a>
                <button ng-if="isLabUser() && lab_user_statuses.indexOf(labRequest.status) != -1" 
                    ng-show="labRequest.assignee != globals.currentUser.userid"
                    class="btn btn-default" type="button"  
                    ng-click="claim(labRequest);" title="Claim">
                    <span><i class="glyphicon glyphicon-eye-open"></i></span>
                    {{'Claim' | translate}}
                </button>
                <button ng-if="isLabUser() && lab_user_statuses.indexOf(labRequest.status) != -1"
                    ng-show="labRequest.assignee == globals.currentUser.userid" 
                    class="btn btn-default" type="button"  
                    ng-click="unclaim(labRequest);" title="Unclaim">
                    <span><i class="glyphicon glyphicon-eye-close"></i></span>
                    {{'Unclaim' | translate}}
                </button>
                <!--<button ng-if="isLabUser()"-->
                <button
                    class="btn btn-default" type="button"
                    ng-click="printPreview();"
                    title="printView"
                    ng-if="isLabUser() || (labRequest.status != 'Rejected' && labRequest.status != 'Waiting for lab approval')">
                    <span><i class="glyphicon glyphicon-eye-close"></i></span>
                    {{'Print Preview' | translate}}
                </button>
            </div>

            <div bs-tabs id="lab-request-details">

              <div title="Details" name="Details" bs-pane>
                <h3 >{{ 'Details' | translate}}</h3>
                <hr>
                <!--Lab Request Id-->
                <div class="form-group">
                  <label class="control-label col-md-2">{{ 'Lab Request Code' | translate }}</label>
                  <div class="col-md-10">
                    <p class="form-control-static"> {{labRequest.request.processInstanceId}}-{{labRequest.lab.number}} </p>
                  </div>
                </div>

                <!--Status-->
                <div class="form-group no-print">
                  <label class="control-label col-md-2">{{ 'Status' | translate }}</label>
                  <div class="col-md-10">
                    <p class="form-control-static" id="requestStatus"> {{labRequest.status}} </p>
                  </div>
                </div>

                <!--Rejected details-->
                <div ng-if="labRequest.status == 'Rejected'" class="no-print">
                  <div class="form-group">
                    <label class="control-label col-md-2">{{ 'Reject date' | translate }}</label>
                    <div class="col-md-10">
                      <p class="form-control-static"> {{labRequest.rejectDate | date}}</p>
                      <br>
                    </div>
                  </div>

                  <div class="form-group" ng-if="isLabUser()">
                    <label class="control-label col-md-2">{{ 'Reject reason' | translate }}</label>
                    <div class="col-md-10">
                      <p class="form-control-static">
                        {{labRequest.rejectReason}}
                        <br><br>
                        <a href="mailto:{{labRequest.requesterEmail}}?subject=Lab request rejected&amp;body=Lab request rejected.%0AReject reason: {{labRequest.rejectReason}}">
                          <button
                            class="btn btn-default" type="button" title="{{'Compose rejection mail' | translate}}">
                            <span><i class="glyphicon glyphicon-envelope"></i></span>
                            {{'Compose rejection mail' | translate}}
                          </button>
                        </a>
                      </p>
                    </div>
                  </div>
                </div>

                <!-- PA Reports Status -->
                <div class="form-group no-print">
                  <label class="control-label col-md-2">{{ 'PA reports' | translate }}</label>
                  <div class="col-md-10">
                    <p class="form-control-static">
                        <span ng-if="labRequest.paReportsSent">
                            {{ 'PA Reports has been sent to requester.' | translate }}
                        </span>
                        <span ng-if="!labRequest.paReportsSent">
                            {{ 'PA Reports has NOT been sent to requester.' | translate }}
                        </span>
                    </p>
                  </div>
                </div>


                <h3 class="no-print"> {{'Request Details' | translate}} </h3>
                <hr class="no-print">

                <!--Parent request details-->
                <div class="form-group no-print">
                    <label class="control-label col-md-2">{{ 'Request ID' | translate }}</label>
                    <div class="col-md-10">
                        <p class="form-control-static">
                            {{labRequest.request.processInstanceId}}
                        </p>
                    </div>
                </div>

                <div class="form-group no-print">
                    <label class="control-label col-md-2">{{ 'Request title' | translate }}</label>
                    <div class="col-md-10">
                        <p class="form-control-static">
                            <a ng-href="/#/request/view/{{labRequest.processInstanceId}}">
                            {{labRequest.request.title}}
                            </a>
                        </p>
                    </div>
                </div>

                <div class="form-group no-print">
                    <label class="control-label col-md-2">{{ 'Creation date' | translate }}</label>
                    <div class="col-md-10">
                        <p class="form-control-static">
                            {{labRequest.request.dateCreated | date }}
                        </p>
                    </div>
                </div>


            <!--Background -->
            <div class="form-group no-print">
                <label class="control-label col-md-2">{{ 'Background' | translate }}</label>
                <div class="col-md-10">
                <p class="form-control-static">
                    {{labRequest.request.background}}
                </p>
                </div>
            </div>

            <!-- Research Question -->
            <div class="form-group no-print">
                <label class="control-label col-md-2">{{ ' Research question' | translate }}</label>
                <div class="col-md-10">
                <p class="form-control-static">
                    {{labRequest.request.researchQuestion}}
                </p>
                </div>
            </div>

            <!-- Hypothesis -->
            <div class="form-group no-print">
                <label class="control-label col-md-2">{{ 'Hypothesis' | translate }}</label>
                <div class="col-md-10">
                <p class="form-control-static">
                    {{labRequest.request.hypothesis}}
                </p>
                </div>
            </div>

            <!-- Methods -->
            <div class="form-group no-print">
                <label class="control-label col-md-2">{{ 'Methods' | translate }}</label>
                <p class="col-md-10">
                    {{labRequest.request.methods}}
                </p>
            </div>

            <!-- Request Type -->
            <div class="form-group no-print">
                <label class="control-label col-md-2">{{ 'Request type' | translate }}</label>
                <div class="col-md-10" ng-init="">
                <p class="form-control-static">
                    {{"Request_Type_" + labRequest.request.type | translate}}
                </p>
                </div>
            </div>

                <div ng-if="globals.currentUser.roles.indexOf('requester') == -1" >
                  <!--Requester info-->
                  <!--Displayed only to users with non requester role-->
                  <!-- Requester -->
                  <div class="form-group">
                    <label class="control-label col-md-2">{{ 'Requester' | translate }}</label>
                    <div class="col-md-10">
                        <p class="form-control-static">
                            {{labRequest.requesterName}}
                            <address ng-bind-html="labRequest.htmlRequesterAddress"></address>
                        </p>
                    </div>
                  </div>
                </div> <!-- end if -->

                <!--Requester lab Info-->
                <div class="form-group">
                  <label class="control-label col-md-2 no-print">{{ 'Requester Lab' | translate }}</label>
                  <label class="control-label col-md-2 print-only" ng-if="isLabUser()">{{ 'Delivery Address' | translate }}</label>
                  <label class="control-label col-md-2 print-only" ng-if="isRequester()">{{ 'Sender Address' | translate }}</label>
                  <div class="col-md-10">
                    <p class="form-control-static">
                      {{"Lab" | translate}} {{labRequest.requesterLab.number}} - {{labRequest.requesterLab.name}}
                      <address ng-bind-html="labRequest.htmlRequesterLabAddress"></address>
                    </p>
                  </div>
                </div>

                <div ng-show="!isLabUser()">
                  <!--Lab Info-->
                  <!--Displayed only to users with non lab user role-->
                  <div class="form-group">
                        <label class="control-label col-md-2 no-print">{{ 'Sender Lab' | translate }}</label>
                        <label class="control-label col-md-2 print-only" ng-if="isRequester()">{{ 'Delivery Address' | translate }}</label>
                        <label class="control-label col-md-2 print-only" ng-if="isLabUser()">{{ 'Sender' | translate }}</label>
                        <div class="col-md-10">
                          <p class="form-control-static">
                            {{"Lab" | translate}} {{labRequest.lab.number}} - {{labRequest.lab.name}}
                            <address ng-bind-html="labRequest.htmlLabAddress"></address>
                          </p>
                        </div>
                  </div>
                </div>

              </div>

              <div title="{{'Samples' | translate}}" name="PA Numbers" bs-pane id="pa-numbers"
                ng-if="isLabUser() || (labRequest.status != 'Rejected' && labRequest.status != 'Waiting for lab approval')">
                <div ng-include="'app/lab-request/pa-numbers.html'"></div>
              </div>

            </div>

            <!--Comments-->
            <div ng-include="'app/lab-request/comments.html'"></div>
      </div> <!-- end of main -->
    </div> <!--end row-->
</div> <!--end container-->
<br>
<br>
