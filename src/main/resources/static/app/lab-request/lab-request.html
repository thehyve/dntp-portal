<!--
Copyright (C) 2016  Stichting PALGA
This file is distributed under the GNU Affero General Public License
(see accompanying file LICENSE).
-->
<div class="container-fluid" ng-controller="LabRequestController">
    <div class="row">

        <!--Side Bar-->
        <div class="col-sm-2 col-xs-4 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class="active"><a href="#/">View</a></li>
            </ul>
        </div>

        <div ng-if="!authenticated">
            <div class="alert alert-danger" role="alert">
                {{ 'Not logged in' | translate }}
            </div>
        </div>

        <div ng-if="!labRequest" class="col-sm-9 col-sm-offset-3 col-xs-8 col-md-10 col-md-offset-2 main">
            <div ng-if="error" class="alert alert-danger" role="alert">
                {{ error | translate }}
            </div>
        </div>

        <!--Main-->
        <div ng-if="labRequest" class="col-sm-9 col-sm-offset-3 col-xs-8 col-md-10 col-md-offset-2 main">

            <h2 id="lab-request-title">
                {{labRequest.labRequestCode}}
            </h2>
            <hr>

            <div class="no-print" style="padding-bottom: 25px;">
                <button class="btn btn-default" type="button" ng-click="edit(labRequest);"
                        title="{{'Actions' | translate}}"
                        ng-if="isLabOrHubUserStatus(labRequest.status)
                            || (isMyRequest(labRequest.request) && isRequesterStatus(labRequest.status))"
                        ng-disabled="(isLabUser() || isHubUser()) && !isCurrentUser(labRequest.assignee)">
                    <span><i class="glyphicon glyphicon-pencil"></i></span>
                    {{'Actions' | translate}}
                </button>
                <button class="btn btn-default" type="button" ng-click="focus('#noteText');"
                        title="{{'Notes' | translate}}">
                    <span><i class="glyphicon glyphicon-comment"></i></span>
                    {{'Notes' | translate}}
                </button>
                 <span ng-if="labRequest.status != 'Waiting for lab approval' && labRequest.status != 'Rejected' &&
                 (isRequester() || isLabUser() || isHubUser())">
                   <a class="btn btn-default" ng-href="/labrequests/{{labRequest.id}}/panumbers/csv">
                       <span><i class="glyphicon glyphicon-download-alt"></i></span>
                       {{'Download ...' |translate: {filename: 'panumbers_' + labRequest.labRequestCode + '.csv'} }}
                   </a>
                 </span>
                <a href="mailto:{{labRequest.requesterEmail}}?subject=Lab request rejected,
                request number {{labRequest.labRequestCode}}&amp;body=Lab request rejected.%0AReject
                reason: {{labRequest.rejectReason}}" ng-if="labRequest.status=='Rejected' && isLabUser()">
                    <button
                            class="btn btn-default" type="button" title="{{'Compose rejection mail' | translate}}">
                        <span><i class="glyphicon glyphicon-envelope"></i></span>
                        {{'Compose rejection mail' | translate}}
                    </button>
                </a>
                <button ng-if="isLabOrHubUserStatus(labRequest.status)"
                        ng-show="!isCurrentUser(labRequest.assignee)"
                        class="btn btn-default" type="button"
                        ng-click="claim(labRequest);" title="{{'Claim' |translate}}">
                    <span><i class="glyphicon glyphicon-eye-open"></i></span>
                    {{'Claim' | translate}}
                </button>
                <button ng-if="isLabOrHubUserStatus(labRequest.status)"
                        ng-show="isCurrentUser(labRequest.assignee)"
                        class="btn btn-default" type="button"
                        ng-click="unclaim(labRequest);" title="{{'Unclaim' |translate}}">
                    <span><i class="glyphicon glyphicon-eye-close"></i></span>
                    {{'Unclaim' | translate}}
                </button>
                <!--<button ng-if="isLabUser()"-->
                <button
                        class="btn btn-default" type="button"
                        ng-click="printPreview();"
                        title="{{'Print preview' | translate}}"
                        ng-if="isLabUser() || isHubUser() || (labRequest.status != 'Rejected' &&
                        labRequest.status != 'Waiting for lab approval')">
                    <span><i class="glyphicon glyphicon-print"></i></span>
                    {{'Print preview' | translate}}
                </button>
            </div>

            <div bs-tabs id="lab-request-details" class="tab-list">

                <div title="Details" name="Details" bs-pane>
                    <h4 class="h4">{{ 'Details' | translate}}</h4>
                    <div ng-include="'app/lab-request/lab-request-contents.html'"></div>
                </div>

                <div title="{{'Samples' | translate}}" name="PA Numbers" bs-pane id="pa-numbers"
                     ng-if="isLabUser() || isHubUser() || (labRequest.status != 'Rejected' &&
                     labRequest.status != 'Waiting for lab approval')">

                    <div id="print-samples-details" class="print-only">

                        <h4 class="h4">{{ 'Details' | translate}}</h4>
                        <hr>
                        <!--Lab Request Id-->
                        <div class="row">
                            <label class="control-label col-xs-4 col-md-2">{{ 'Lab request code' | translate }}</label>
                            <div class="col-xs-8 col-md-10">
                                <p class="form-control-static">{{labRequest.labRequestCode}}</p>
                            </div>
                        </div>

                        <div ng-if="isRequester() || isLabUser()">
                            <!--Requester info-->
                            <!--Displayed only to users with non requester role-->

                            <!-- Requester -->
                            <div class="row">
                                <label class="control-label col-xs-4 col-md-2">{{ 'Requester' | translate }}</label>
                                <div class="col-xs-8 col-md-10">
                                    <p class="form-control-static">
                                        {{labRequest.requesterName}}
                                    <address ng-bind-html="labRequest.htmlRequesterAddress"></address>
                                    </p>
                                </div>
                            </div>

                            <!-- Pathologist name -->
                            <div class="row">
                                <label class="control-label col-xs-4 col-sm-4">{{ 'Pathologist' | translate }}</label>
                                <p class="col-xs-6 col-sm-6">
                                    {{labRequest.request.pathologistName}}
                                </p>
                            </div>

                            <!-- Pathologist email -->
                            <div class="row">
                                <label class="control-label col-xs-4 col-sm-4">{{ 'Pathologist email' | translate }}</label>
                                <p class="col-xs-6 col-sm-6">
                                    {{labRequest.request.pathologistEmail}}
                                </p>
                            </div>

                        </div> <!-- end if -->

                        <!--Requester lab Info-->
                        <div class="row">
                            <label class="control-label col-xs-4 col-md-2" ng-if="isLabUser() || isHubUser()">{{ 'Delivery
                                address' | translate }}</label>
                            <label class="control-label col-xs-4 col-md-2" ng-if="isRequester()">{{ 'Sender address' |
                                translate }}</label>
                            <div class="col-xs-8 col-md-10">
                                <p class="form-control-static">
                                    {{'Lab' | translate}} {{labRequest.requesterLab.number}} -
                                    {{labRequest.requesterLab.name}}
                                <address class="address" ng-bind-html="labRequest.htmlRequesterLabAddressPrint"></address>
                                </p>
                            </div>
                        </div>

                        <div ng-show="!isLabUser()">
                            <!--Lab Info-->
                            <!--Displayed only to users with non lab user role-->
                            <div class="row">
                                <label class="control-label col-xs-4 col-md-2" ng-if="isRequester()">{{ 'Delivery address'
                                    | translate }}</label>
                                <label class="control-label col-xs-4 col-md-2" ng-if="isLabUser() || isHubUser()">{{
                                    'Sender' | translate }}</label>
                                <div class="col-xs-8 col-md-10">
                                    <p class="form-control-static">
                                        {{'Lab' | translate}} {{labRequest.lab.number}} - {{labRequest.lab.name}}
                                    <address class="address" ng-bind-html="labRequest.htmlLabAddress"></address>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-include="'app/lab-request/pa-numbers.html'"></div>
                </div>

            </div>

            <!--Comments-->
            <div ng-include="'app/lab-request/comments.html'"></div>
        </div> <!-- end of main -->
    </div> <!--end row-->
</div> <!--end container-->
<br>
<br>
