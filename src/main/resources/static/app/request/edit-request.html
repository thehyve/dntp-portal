<div class="modal" tabindex="-1" role="dialog" aria-hidden="true" style="overflow: auto" ng-keypress="cancelByEscKey($event, request);">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form class="form-horizontal" role="form" name="requestEditForm" novalidate>
                <div class="modal-header">
                    <h3 class="modal-title" ng-if="request.status=='Open'">{{ 'New request' | translate }}</h3>
                    <h3 class="modal-title" ng-if="request.status=='Review'">{{ 'Edit' | translate }}: {{request.requestNumber}} {{request.title}}</h3>
                    <h3 class="modal-title" ng-if="request.status=='Approval'">{{ 'Evaluate' |translate }}: {{request.requestNumber}} {{request.title}}</h3>
                </div>
                <div class="modal-body">

                    <div class="alert alert-danger" role="alert" ng-show="error">
                        {{ error }}
                    </div>

                    <h3>{{'General details' |translate}}</h3>
                    <hr>

                    <!-- Principal Investigator -->
                    <div class="form-group" ng-class="{ 'has-error' : requestEditForm.contactPersonName.$invalid && requestEditForm.contactPersonName.$dirty }">
                        <label class="control-label col-sm-3" for="contactPersonName">{{ 'Principal investigator' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="contactPersonName" name="contactPersonName" 
                                placeholder="{{ 'Principal investigator' | translate }}" title="{{ 'Principal investigator' | translate }}"
                                ng-model="request.contactPersonName" ng-maxlength="100" 
                                data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Principal investigator'|translate}}" data-trigger="focus" bs-popover 
                                required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.contactPersonName.$error.maxlength">{{ 'Input value is too long' | translate }}</span>
                            <span class="help-block" ng-show="requestEditForm.contactPersonName.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                        </div>
                    </div>


                    <!-- Pathologist name -->
                    <div class="form-group" ng-class="{ 'has-error' : requestEditForm.pathologistName.$invalid && requestEditForm.pathologistName.$dirty }">
                        <label class="control-label col-sm-3" for="pathologistName">{{ 'Pathologist' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="pathologistName" name="pathologistName" 
                                placeholder="{{ 'Pathologist' | translate }}" title="{{ 'Pathologist' | translate }}"
                                ng-model="request.pathologistName" ng-maxlength="100" 
                                data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Pathologist'|translate}}" data-trigger="focus" bs-popover
                                required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.pathologistName.$error.maxlength">{{ 'Input value is too long' | translate }}</span>
                            <span class="help-block" ng-show="requestEditForm.pathologistName.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                        </div>
                    </div>

                    <!-- Pathologist email -->
                    <div class="form-group" ng-class="{ 'has-error' : requestEditForm.pathologistEmail.$invalid && requestEditForm.pathologistEmail.$dirty }">
                        <label class="control-label col-sm-3" for="pathologistEmail"></label>
                        <div class="col-sm-8">
                            <input type="email" class="form-control" id="pathologistEmail" name="pathologistEmail" 
                                placeholder="{{ 'Pathologist email' | translate }}" title="{{ 'Pathologist email' | translate }}"
                                ng-model="request.pathologistEmail" ng-maxlength="100"
                                data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Pathologist email'|translate}}" data-trigger="focus" bs-popover
                                required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.pathologistEmail.$error.maxlength">{{ 'Input value is too long' | translate }}</span>
                            <span class="help-block" ng-show="requestEditForm.pathologistEmail.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                            <span class="help-block" ng-show="requestEditForm.pathologistEmail.$invalid && requestEditForm.pathologistEmail.$dirty">
                                {{ 'Email format is invalid' | translate }}
                            </span>
                        </div>
                    </div>

                    <!-- Previous contact -->
                    <div class="form-group" ng-mouseover="showPopover('previousContact')" ng-mouseleave="hidePopover('previousContact')">
                        <label class="control-label col-sm-3">
                            {{'Previous contact' | translate}}
                        </label>
                        <div class="col-sm-6 form-control-static"
                            data-placement="top-right" data-animation="am-flip-x" 
                            data-content="{{'popover: Previous contact'|translate}}" 
                            data-trigger="manual" bs-show="popover.previousContact" bs-popover
                            title="{{'Previous contact' | translate}}"
                            >
                            {{'Did you contact Palga previously?' | translate}}
                            <br/>
                            <input type="radio" id="previousContactYes" name="previousContact" ng-model="request.previousContact" ng-value="true" ng-checked="request.previousContact" 
                            ng-focus="showPopover('previousContact')" ng-blur="hidePopover('previousContact')">
                            <label class="normal" for="previousContactYes">{{'Yes' | translate}}</label>
                            &nbsp;
                            <input type="radio" id="previousContactNo" name="previousContact" ng-model="request.previousContact" ng-value="false" ng-checked="!request.previousContact" ng-click="resetPreviousContactValues(request);"
                             ng-focus="showPopover('previousContact')" ng-blur="hidePopover('previousContact')">
                            <label class="normal" for="previousContactNo">{{'No' | translate}}</label>
                            <br>
                        </div>
                    </div>

                    <!-- Previous contact description  -->
                    <div class="form-group" ng-show="request.previousContact"
                         ng-class="{ 'has-error' : requestEditForm.previousContactDescription.$invalid  && requestEditForm.previousContactDescription.$dirty }">
                        <label class="control-label col-sm-3" for="previousContactDescription"></label>
                        <div class="col-sm-8">
                        <textarea type="text" class="form-control" id="previousContactDescription" name="previousContactDescription" 
                            placeholder="{{ 'Description of previous contact' | translate }}" title="{{ 'Description of previous contact' | translate }}"
                            ng-model="request.previousContactDescription" 
                            ng-required="request.previousContact"
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Description of previous contact'|translate}}" data-trigger="focus" bs-popover
                            ></textarea>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.previousContactDescription.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                        </div>
                    </div>

                    <!-- Title -->
                    <div class="form-group" ng-class="{ 'has-error' : (requestEditForm.requestTitle.$invalid || requestEditForm.requestTitle.$error.required) && requestEditForm.requestTitle.$dirty }">
                        <label class="control-label col-sm-3" for="requestTitle">{{ 'Running title' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="requestTitle" name="requestTitle" 
                                placeholder="{{ 'Title' | translate }}" title="{{ 'Title' | translate }}"
                                ng-model="request.title" ng-maxlength="50"
                                data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Title'|translate}}" data-trigger="focus" bs-popover 
                                required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.requestTitle.$error.required">{{ 'Required field' | translate }}</span>
                            <span class="help-block" ng-show="requestEditForm.requestTitle.$error.maxlength">{{ 'Input value is too long' | translate }}</span>
                        </div>
                    </div>

                    <!-- Background -->
                    <div class="form-group" ng-class="{ 'has-error' : (requestEditForm.background.$invalid || requestEditForm.background.$error.required) && requestEditForm.background.$dirty }">
                        <label class="control-label col-sm-3" for="background">{{ 'Background' | translate }}</label>
                        <div class="col-sm-8">
                        <textarea type="text" class="form-control" id="background" name="background" 
                            placeholder="{{ 'Background' | translate }}" title="{{ 'Background' | translate }}"
                            ng-model="request.background" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Background'|translate}}" data-trigger="focus" bs-popover
                            required></textarea>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.background.$error.required">{{ 'Required field' | translate }}</span>
                        </div>
                    </div>

                    <!-- Research Question -->
                    <div class="form-group" ng-class="{ 'has-error' : (requestEditForm.researchQuestion.$invalid || requestEditForm.researchQuestion.$error.required) && requestEditForm.researchQuestion.$dirty }">
                        <label class="control-label col-sm-3" for="researchQuestion">{{ 'Research question' | translate }}</label>
                        <div class="col-sm-8">
                        <textarea type="text" class="form-control" id="researchQuestion" name="researchQuestion" 
                            placeholder="{{ 'Research question' | translate }}" title="{{ 'Research question' | translate }}"
                            ng-model="request.researchQuestion" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Research question'|translate}}" data-trigger="focus" bs-popover
                            required></textarea>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.researchQuestion.$error.required">{{ 'Required field' | translate }}</span>
                        </div>
                    </div>

                    <!-- Hypothesis -->
                    <div class="form-group" ng-class="{ 'has-error' : (requestEditForm.hypothesis.$invalid || requestEditForm.hypothesis.$error.required) && requestEditForm.hypothesis.$dirty }">
                        <label class="control-label col-sm-3" for="requestTitle">{{ 'Hypothesis' | translate }}</label>
                        <div class="col-sm-8">
                        <textarea type="text" class="form-control" id="hypothesis" name="hypothesis" 
                            placeholder="{{ 'Hypothesis' | translate }}" title="{{ 'Hypothesis' | translate }}"
                            ng-model="request.hypothesis" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Hypothesis'|translate}}" data-trigger="focus" bs-popover
                            required></textarea>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.hypothesis.$error.required">{{ 'Required field' | translate }}</span>
                        </div>
                    </div>

                    <!-- Methods -->
                    <div class="form-group" ng-class="{ 'has-error' : (requestEditForm.methods.$invalid || requestEditForm.methods.$error.required) && requestEditForm.methods.$dirty }">
                        <label class="control-label col-sm-3" for="requestTitle">{{ 'Methods' | translate }}</label>
                        <div class="col-sm-8">
                        <textarea type="text" class="form-control" id="methods" name="methods" 
                            placeholder="{{ 'Methods' | translate }}" title="{{ 'Methods' | translate }}"
                            ng-model="request.methods" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Methods'|translate}}" data-trigger="focus" bs-popover
                            required></textarea>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.methods.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                        </div>
                    </div>

                    <!--Request Type-->
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            {{'Request type' | translate}}
                        </label>
                        <div class="col-sm-6"
                            ng-mouseover="showPopover('requestType')" ng-mouseleave="hidePopover('requestType')"
                            data-placement="top-right" data-animation="am-flip-x" 
                            data-content="{{'popover: Request type'|translate}}" 
                            data-trigger="manual" bs-show="popover.requestType" bs-popover
                            title="{{'Request type' | translate}}"
                            >
                            <input name="requestType" type="radio" ng-model="request.type" value="1" id="radio-numbers" 
                                ng-focus="showPopover('requestType')" ng-blur="hidePopover('requestType')">
                            <label class="normal" for="radio-numbers">{{'Request for numbers only' | translate}}</label><br>
                            <input name="requestType" type="radio" ng-model="request.type" value="2" id="radio-excerpts"
                                ng-focus="showPopover('requestType')" ng-blur="hidePopover('requestType')">
                            <label class="normal" for="radio-excerpts">{{'Request for excerpts' | translate}}</label><br>
                            <input name="requestType" type="radio" ng-model="request.type" value="3" id="radio-excerpts-PA"
                                ng-focus="showPopover('requestType')" ng-blur="hidePopover('requestType')">
                            <label class="normal" for="radio-excerpts-PA">{{'Request for excerpts + PA reports' | translate}}</label><br>
                            <input name="requestType" type="radio" ng-model="request.type" value="4" id="radio-excerpts-materials"
                                ng-focus="showPopover('requestType')" ng-blur="hidePopover('requestType')">
                            <label class="normal" for="radio-excerpts-materials">{{'Request for excerpts + materials' | translate}}</label><br>
                            <input name="requestType" type="radio" ng-model="request.type" value="5" id="radio-excerpts-PA-materials"
                                ng-focus="showPopover('requestType')" ng-blur="hidePopover('requestType')">
                            <label class="normal" for="radio-excerpts-PA-materials">{{'Request for excerpts + PA reports + materials' | translate}}</label><br>
                            <input name="requestType" type="radio" ng-model="request.type" value="6" id="radio-PA"
                                ng-focus="showPopover('requestType')" ng-blur="hidePopover('requestType')">
                            <label class="normal" for="radio-PA">{{'Request for PA-reports only' | translate}}</label><br>
                            <input name="requestType" type="radio" ng-model="request.type" value="7" id="radio-materials"
                                ng-focus="showPopover('requestType')" ng-blur="hidePopover('requestType')">
                            <label class="normal" for="radio-materials">{{'Request for materials only' | translate}}</label>
                        </div>
                    </div>

                    <h3>{{'Billing address'|translate}}</h3>
                    <hr>
                    <!-- Address -->
                    <div class="form-group"
                        ng-class="{ 'has-error' : requestEditForm.address1.$invalid && requestEditForm.address1.$dirty }">
                        <label class="control-label col-sm-3" for="address1">{{ 'Address' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="address1" id="address1" 
                            placeholder="{{ 'Address' | translate }}" title="{{ 'Address' | translate }}"
                            ng-model="request.billingAddress.address1" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Address'|translate}}" data-trigger="focus" bs-popover
                            required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.address1.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                            <input type="text" class="form-control" id="address2"
                            ng-model="request.billingAddress.address2" >
                        </div>
                    </div>
            
                    <!-- Postal code -->
                    <div class="form-group" 
                        ng-class="{ 'has-error' : (requestEditForm.postalcode.$invalid && requestEditForm.postalcode.$dirty)
                            || (requestEditForm.city.$invalid && requestEditForm.city.$dirty) }">
                        <label class="control-label col-sm-3" for="postalcode">{{ 'Postal code' | translate }}, {{ 'City' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="postalcode" id="postalcode" 
                            placeholder="{{ 'Postal code' | translate }}" title="{{ 'Postal code' | translate }}"
                            ng-model="request.billingAddress.postalCode" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Postal code'|translate}}" data-trigger="focus" bs-popover
                            required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.postalcode.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                            <input type="text" class="form-control" name="city" id="city" 
                            placeholder="{{ 'City' | translate }}" title="{{ 'City' | translate }}"
                            ng-model="request.billingAddress.city" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: City'|translate}}" data-trigger="focus" bs-popover
                            required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.city.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                        </div>
                    </div>
            
                    <!-- State / Province -->
                    <div class="form-group">
                        <label class="control-label col-sm-3" for="stateProvince">{{ 'Province' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="stateProvince" 
                            placeholder="{{ 'Province' | translate }}" title="{{ 'Province' | translate }}"
                            ng-model="request.billingAddress.stateProvince" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Province'|translate}}" data-trigger="focus" bs-popover
                            >
                        </div>
                    </div>
            
                    <!-- Billing E-mail -->
                    <div class="form-group" ng-class="{ 'has-error' : requestEditForm.billingEmail.$invalid && requestEditForm.billingEmail.$dirty }">
                        <label class="control-label col-sm-3" for="billingEmail">{{ 'E-mail' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="email" class="form-control" name="billingEmail" id="billingEmail" 
                            placeholder="{{ 'E-mail' | translate }}" title="{{ 'E-mail' | translate }}"
                            ng-model="request.billingAddress.email" ng-maxlength="255"
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: E-mail'|translate}}" data-trigger="focus" bs-popover
                            >
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.billingEmail.$error.maxlength">{{ 'Input value is too long' | translate }}</span>
                            <span class="help-block" ng-show="requestEditForm.billingEmail.$invalid && requestEditForm.billingEmail.$dirty">
                                {{ 'Email format is invalid' | translate }}
                            </span>

                        </div>
                    </div>
            
                    <!-- Telephone -->
                    <div class="form-group">
                        <label class="control-label col-sm-3" for="telephone">{{ 'Telephone' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="telephone" 
                            placeholder="{{ 'Telephone' | translate }}" title="{{ 'Telephone' | translate }}"
                            ng-model="request.billingAddress.telephone" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Telephone'|translate}}" data-trigger="focus" bs-popover
                            >
                        </div>
                    </div>
                    
                    <h3>{{'Billing information' | translate}}</h3>
                    <hr>
                    <!-- Charge number -->
                    <div class="form-group" ng-class="{ 'has-error' : requestEditForm.chargeNumber.$invalid && requestEditForm.chargeNumber.$dirty }">
                        <label class="control-label col-sm-3" for="chargeNumber">{{ 'Charge number' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="chargeNumber" name="chargeNumber" 
                                placeholder="{{ 'Charge number' | translate }}" title="{{ 'Charge number' | translate }}"
                                ng-model="request.chargeNumber" ng-maxlength="100"
                                data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Charge number'|translate}}" data-trigger="focus" bs-popover
                                required>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.chargeNumber.$error.maxlength">{{ 'Input value is too long' | translate }}</span>
                            <span class="help-block" ng-show="requestEditForm.chargeNumber.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                        </div>
                    </div>

                    <!-- Research number -->
                    <div class="form-group" ng-class="{ 'has-error' : requestEditForm.researchNumber.$invalid && requestEditForm.researchNumber.$dirty }">
                        <label class="control-label col-sm-3" for="researchNumber">{{ 'Research number' | translate }}</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="researchNumber" name="researchNumber" 
                                placeholder="{{ 'Research number' | translate }}" title="{{ 'Research number' | translate }}"
                                ng-model="request.researchNumber" ng-maxlength="100"
                                data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Research number'|translate}}" data-trigger="focus" bs-popover
                                >
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.researchNumber.$error.maxlength">{{ 'Input value is too long' | translate }}</span>
                        </div>
                    </div>


                    <div ng-show="request.type != 1">
                    <h3>{{ 'Data Linkage' | translate }}</h3>
                    <hr>

                    <!-- Data Linkage -->
                    <div class="form-group" ng-mouseover="showPopover('dataLinkage')" ng-mouseleave="hidePopover('dataLinkage')">
                        <label class="control-label col-sm-3">
                            {{'Data linkage' | translate}}
                        </label>
                        <div class="col-sm-8"
                            data-placement="top-left" data-animation="am-flip-x" data-content="{{'popover: Data linkage'|translate}}" data-trigger="manual" bs-show="popover.dataLinkage" bs-popover>
                            <input type="radio" id="linkageWithPersonalDataYes" name="linkageWithPersonalData" ng-model="request.linkageWithPersonalData" ng-value="true" ng-checked="request.linkageWithPersonalData" 
                                ng-focus="showPopover('dataLinkage')" ng-blur="hidePopover('dataLinkage')">
                            <label class="normal" for="linkageWithPersonalDataYes">{{'Linkage with own or external personal data' | translate}}</label><br>
                            <input type="radio" id="linkageWithPersonalDataNo" name="linkageWithPersonalData" ng-model="request.linkageWithPersonalData" ng-value="false" ng-checked="!request.linkageWithPersonalData" ng-click="resetDataLinkageValues(request);"
                                ng-focus="showPopover('dataLinkage')" ng-blur="hidePopover('dataLinkage')">
                            <label class="normal" for="linkageWithPersonalDataNo">{{'No data linkage required' | translate}}</label><br>
                        </div>
                    </div>
                    </div>

                    <!-- Data Linkage Notes  -->
                    <div class="form-group" ng-show="request.type != 1 && request.linkageWithPersonalData"
                         ng-class="{ 'has-error' : requestEditForm.linkageWithPersonalDataNotes.$invalid  && requestEditForm.linkageWithPersonalDataNotes.$dirty }">
                        <label class="control-label col-sm-3" for="requestTitle">{{ 'Data linkage notes' | translate }}</label>
                        <div class="col-sm-8">
                        <textarea type="text" class="form-control" id="linkageWithPersonalDataNotes" name="linkageWithPersonalDataNotes" 
                            placeholder="{{ 'Notes for linkage with personal data' | translate }}" title="{{ 'Notes for linkage with personal data' | translate }}"
                            ng-model="request.linkageWithPersonalDataNotes" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Notes for linkage with personal data'|translate}}" data-trigger="focus" bs-popover
                            ng-required="request.linkageWithPersonalData"></textarea>
                            <!-- errors -->
                            <span class="help-block" ng-show="requestEditForm.linkageWithPersonalDataNotes.$error.required">
                                {{ 'Required field' | translate }}
                            </span>
                        </div>
                    </div>

                    <!-- Informed Consent  -->
                    <div class="form-group" ng-class="" ng-show="request.type != 1 && request.linkageWithPersonalData"
                        ng-mouseover="showPopover('informedConsent')" ng-mouseleave="hidePopover('informedConsent')">
                        <label class="control-label col-sm-3" for="informedConsentYes">
                            {{'Informed consent' | translate}}
                        </label>
                        <div class="col-sm-8"
                            data-placement="top-left" data-animation="am-flip-x" data-content="{{'popover: Informed consent'|translate}}" data-trigger="manual" bs-show="popover.informedConsent" bs-popover>
                            <input type="radio" id="informedConsentYes" name="informedConsent" ng-model="request.informedConsent" ng-value="true" ng-checked="request.informedConsent" ng-click="resetDataLinkageValues(request, true);"
                                ng-focus="showPopover('informedConsent')" ng-blur="hidePopover('informedConsent')">
                            <label class="normal" for="informedConsentYes">{{'Yes' | translate}}</label><br>
                            <input type="radio" id="informedConsentNo" name="informedConsent" ng-model="request.informedConsent" ng-value="false" ng-checked="!request.informedConsent"
                                ng-focus="showPopover('informedConsent')" ng-blur="hidePopover('informedConsent')">
                            <label class="normal" for="informedConsentNo">{{'No' | translate}}</label>
                        </div>
                    </div>

                    <!-- Reason Using Personal Data  -->
                    <div class="form-group" ng-show="(request.type != 1 && request.linkageWithPersonalData)"
                         ng-class="{ 'has-error' : requestEditForm.reasonUsingPersonalData.$invalid && requestEditForm.reasonUsingPersonalData.$dirty }">
                        <label class="control-label col-sm-3" for="requestTitle">{{ 'Reason using personal data' | translate }}</label>
                        <div class="col-sm-8">
                        <textarea type="text" class="form-control" id="reasonUsingPersonalData" name="reasonUsingPersonalData" 
                            placeholder="{{ 'Reason using personal data' | translate }}" title="{{ 'Reason using personal data' | translate }}"
                            ng-model="request.reasonUsingPersonalData" ng-disabled="request.informedConsent" 
                            data-placement="top-right" data-animation="am-flip-x" data-content="{{'popover: Reason using personal data'|translate}}" data-trigger="focus" bs-popover
                            ng-required="(request.type != 1 && request.linkageWithPersonalData && !request.informedConsent)"></textarea>
                        <!-- errors -->
                        <span class="help-block" ng-show="requestEditForm.reasonUsingPersonalData.$error.required">
                            {{ 'Required field' | translate }}
                        </span>
                        </div>
                    </div>

                    <br>

                    <h3>{{ 'Attachments' | translate }}</h3>
                    <hr>

                    <div ng-show="request.attachments.length < 1"><p><i>{{'No attachment found.' | translate}}</i></p></div>

                    <ul class="list-group">
                        <li class="list-group-item" ng-repeat="file in request.attachments">
                            <label><a ng-href="/requests/{{request.processInstanceId}}/files/{{file.id}}">{{file.name}}</a></label>
                            <span class="pull-right">
                            <span class="btn-group">
                                <button class="btn btn-default" type="button" title="{{'Delete'|translate}}"
                                        ng-click="removeFile(file)"
                                        ng-if="request.status=='Open' || (isPalga() && request.status=='Review')"
                                        >
                                    {{'Delete'|translate}}
                                </button>
                            </span>
                            </span>
                        </li>
                    </ul>
                    <!-- Attachment upload -->
                    <div flow-init="Upload.flow_options({target:'/requests/'+request.processInstanceId+'/files'})"
                         flow-name="attachmentFlow"
                         flow-files-submitted="fileuploadsubmitted('attachment'); Upload.uploadFile($flow)"
                         flow-file-success="Upload.fileUploadSuccess('attachment', $message, $file); fileuploadsuccess(request, $message, 'attachment', $flow)"
                         flow-file-error="fileuploaderror(Upload.fileUploadError($message, $file, $flow), 'attachment')"
                         ng-if="request.status=='Open' || (isPalga() && request.status=='Review')">
                        <div class="alert alert-danger" role="alert" ng-if="upload_result['attachment'] == 'error'">
                            <span ng-bind-html="upload_error['attachment']"></span>
                        </div>

                        <div>
                            <input type="file" flow-btn id="test-upload-attachment1" style="display:none" />
                            <button class="btn btn-default" 
                                data-placement="top-left" data-animation="am-flip-x" data-content="{{'popover: Upload file'|translate}}" data-trigger="hover focus" bs-popover
                                flow-btn>{{'Upload file'|translate}}</button>
                        </div>
                        <br>
                        <div class="alert" flow-drop style="border: 2px dashed gray; text-align: center"
                             flow-drag-enter="style={border:'4px dashed lightgreen'}"
                             flow-drag-leave="style={border: '2px dashed gray'}"
                             ng-style="style">
                            ({{'drag and drop your file here'|translate}})
                        </div>
                    </div>

                    <h3>{{ 'Medical ethical committee approval' | translate }}</h3>
                    <hr>

                    <div ng-show="request.medicalEthicalCommitteeApprovalAttachments.length < 1"><p><i>{{'No attachment found.' | translate}}</i></p></div>

                    <ul class="list-group">
                        <li class="list-group-item" ng-repeat="file in request.medicalEthicalCommitteeApprovalAttachments">
                            <label><a ng-href="/requests/{{request.processInstanceId}}/files/{{file.id}}">{{file.name}}</a></label>
                            <span class="pull-right">
                            <span class="btn-group">
                                <button class="btn btn-default" type="button" title="{{'Delete'|translate}}"
                                        ng-click="removeMECFile(file)"
                                        ng-if="isRequester() && (
                                            request.status=='Open' 
                                            || request.status=='Review'
                                            || request.status=='Approval'
                                            || request.status=='DataDelivery'
                                            || request.status=='SelectionReview'
                                            )"
                                        >
                                    {{'Delete'|translate}}
                                </button>
                            </span>
                            </span>
                        </li>
                    </ul>
                    <!-- Medical Ethical Committee approval upload -->
                    <div flow-init="Upload.flow_options({target:'/requests/'+request.processInstanceId+'/mecFiles'})"
                         flow-name="mecApprovalFlow"
                         flow-files-submitted="fileuploadsubmitted('mec_approval'); Upload.uploadFile($flow)"
                         flow-file-success="Upload.fileUploadSuccess('MEC approval', $message, $file); fileuploadsuccess(request, $message, 'mec_approval', $flow)"
                         flow-file-error="fileuploaderror(Upload.fileUploadError($message, $file, $flow), 'mec_approval')"
                         ng-if="isRequester() && (
                                            request.status=='Open' 
                                            || request.status=='Review'
                                            || request.status=='Approval'
                                            || request.status=='DataDelivery'
                                            || request.status=='SelectionReview'
                                            )">
                        <div class="alert alert-danger" role="alert" ng-if="upload_result['mec_approval'] == 'error'">
                            <span ng-bind-html="upload_error['mec_approval']"></span>
                        </div>
                        <div>
                            <input type="file" flow-btn id="test-upload-attachment2" style="display:none" />
                            <button class="btn btn-default" 
                                data-placement="top-left" data-animation="am-flip-x" data-content="{{'popover: Upload medical ethical committee approval'|translate}}" data-trigger="hover focus" bs-popover
                                flow-btn>{{'Upload medical ethical committee approval'|translate}}</button>
                        </div>
                        <br>
                        <div class="alert" flow-drop style="border: 2px dashed gray; text-align: center"
                             flow-drag-enter="style={border:'4px dashed lightgreen'}"
                             flow-drag-leave="style={border: '2px dashed gray'}"
                             ng-style="style">
                            ({{'drag and drop your file here'|translate}})
                        </div>
                    </div>


                    <div ng-include="'app/request/request-review.html'" ng-if="request.status=='Review'"></div>

                    <div ng-if="request.status=='Approval' &&
                        (globals.currentUser.roles.indexOf('palga') != -1)">

                        <br>

                        <h3>{{'Checks by privacy committee'|translate}}</h3>
                        <hr>

                        <!-- Is sent to privacy commitee -->
                        <div class="form-group" ng-class="">
                            <label class="control-label col-sm-3">
                                &nbsp;
                            </label>
                            <div class="col-sm-8">
                                <input type="checkbox" id="sentToPrivacyComm" name="sentToPrivacyComm" value="1"
                                       ng-model="request.sentToPrivacyCommittee"> &nbsp; 
                                <label class="normal" for="sentToPrivacyComm">{{ 'This request has been sent to the privacy committee to be checked.' | translate }}</label>
                            </div>
                        </div>

                        <!-- Outcome -->
                        <div class="form-group">
                            <label class="control-label col-sm-3" for="privacyCommitteeOutcome">{{ 'Outcome' | translate }}</label>
                            <div class="col-sm-8">
                            <textarea type="text" class="form-control" id="privacyCommitteeOutcome" name="privacyCommitteeOutcome" placeholder="{{ 'Outcome' | translate }}"
                                  ng-model="request.privacyCommitteeOutcome"></textarea>
                            </div>
                        </div>

                        <!-- Outcome Reference -->
                        <div class="form-group">
                            <label class="control-label col-sm-3" for="privacyCommitteeOutcomeRef">{{ 'Outcome reference' | translate }}</label>
                            <div class="col-sm-8">
                            <textarea type="text" class="form-control" id="privacyCommitteeOutcomeRef" name="privacyCommitteeOutcomeRef" placeholder="{{ 'Outcome Reference' | translate }}"
                                  ng-model="request.privacyCommitteeOutcomeRef"></textarea>
                            </div>
                        </div>

                        <!-- Outcome Emails -->
                        <div class="form-group">
                            <label class="control-label col-sm-3" for="privacyCommitteeEmails">{{ 'Emailing history' | translate }}</label>
                            <div class="col-sm-8">
                            <textarea type="text" class="form-control" id="privacyCommitteeEmails" name="privacyCommitteeEmails" placeholder="{{ 'Emailing History' | translate }}"
                                      ng-model="request.privacyCommitteeEmails"></textarea>
                            </div>
                        </div>

                    </div> <!-- endif in 'Review' status and user type 'palga' -->

                  <!--Upload Files if in 'DataDelivery' status-->
                  <div ng-include="'app/request/upload-file.html'" ng-if="request.status=='DataDelivery'"></div>

                    <!--Approvals-->
                    <div ng-include="'app/request/approvals.html'"
                         ng-if="request.status=='Approval' &&
                         (  globals.currentUser.roles.indexOf('palga') != -1 ||
                            globals.currentUser.roles.indexOf('scientific_council') != -1)"></div>


                <div ng-if="request.status=='Approval' &&
                        globals.currentUser.roles.indexOf('palga') != -1">
                <h3>{{'Finalisation checks'|translate}}</h3>
                <hr>
                <!-- Scientific council has approved -->
                <div class="form-group" ng-class="">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-8">
                        <input type="checkbox" id="scientificCouncilApproved" name="scientificCouncilApproved"
                               ng-model="request.scientificCouncilApproved"> &nbsp;
                       <label class="normal" for="scientificCouncilApproved">{{ 'The scientific council has approved.' | translate }}</label>
                    </div>
                </div>

                <!-- There are no privacy issues or the privacy committee has approved. -->
                <div class="form-group" ng-class="">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-8">
                        <input type="checkbox" id="privacyCommitteeApproved" name="privacyCommitteeApproved"
                               ng-model="request.privacyCommitteeApproved"> &nbsp;
                        <label class="normal" for="privacyCommitteeApproved">{{ 'There are no privacy issues or the privacy committee has approved.' | translate }}</label>
                    </div>
                </div>
                </div>


                </div> <!--end modal-body-->

                <div class="modal-footer">
                    <a id="cancel-new-request" class="btn btn-default pull-left" ng-click="cancel(request);">
                        {{'Cancel'|translate}}
                    </a>
                    <button id="submit-new-request" class="btn btn-warning" type="button"
                        ng-if="request.status=='Open'"
                        ng-click="submitRequest(request)"
                        ng-disabled="requestEditForm.$invalid || dataLoading">
                        {{'Submit'|translate}}
                    </button>
                    <button class="btn btn-warning" type="button"
                        ng-if="request.status=='Review' && globals.currentUser.roles.indexOf('palga') != -1"
                        ng-click="submitForApproval(request)"
                        ng-disabled="requestEditForm.$invalid
                            || !request.agreementReached
                            || !request.requesterValid
                            || !request.requesterAllowed
                            || !request.contactPersonAllowed
                            || !request.requesterLabValid
                            || dataLoading
                        ">
                            {{'Submit for approval'|translate}}
                    </button>
                    <button class="btn btn-warning" type="button"
                        ng-if="request.status=='Approval' && globals.currentUser.roles.indexOf('palga') != -1"
                        ng-click="finalise(request)"
                        ng-disabled="requestEditForm.$invalid
                            || !request.scientificCouncilApproved
                            || !request.privacyCommitteeApproved
                            || dataLoading
                        ">
                            {{'Finalise'|translate}}
                    </button>
                    <button class="btn btn-danger" type="button"
                        ng-if="(request.status=='Review' || request.status=='Approval') && globals.currentUser.roles.indexOf('palga') != -1"
                        ng-click="reject(request)"
                        ng-disabled="requestEditForm.$invalid || dataLoading">
                            {{'Reject'|translate}}
                    </button>
                    <button class="btn btn-info" type="submit" ng-click="update(request);"
                            ng-disabled="requestEditForm.$invalid || dataLoading">{{'Save'|translate}}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
