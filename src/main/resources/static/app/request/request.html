<div class="container-fluid">
    <div class="row">

        <!--Side Bar-->
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class="active"><a href="#/">View</a></li>
            </ul>
        </div>

        <div ng-show="!authenticated">
            <div class="alert alert-danger" role="alert">
                {{ 'Not logged in' | translate }}
            </div>
        </div>

        <div ng-if="!request" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div ng-show="error" class="alert alert-danger" role="alert">
                {{ error | translate }}
            </div>
        </div>

        <!--Main-->
        <div ng-if="authenticated && request" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

            <div ng-show="error" class="alert alert-danger" role="alert">
                {{ error | translate }}
            </div>

            <h2>{{request.processInstanceId}} - {{ 'Request' | translate }} {{request.title}}</h2>
            <hr>

            <div style="padding-bottom: 25px;">
                <button class="btn btn-default" type="button"  ng-click="edit(request);" title="Edit"
                        ng-if="(request.status != 'Closed') && (request.status != 'Rejected') &&
                        (
                        (request.status == 'Open' && isRequester())
                        || (request.status != 'DataDelivery' && request.status != 'SelectionReview' && isPalga())
                        )"
                        ng-disabled="globals.currentUser.roles.indexOf('palga') != -1 && request.assignee != globals.currentUser.userid">
                    <span><i class="glyphicon glyphicon-pencil"></i></span>
                    {{'Edit' | translate}}
                </button>
                <button ng-if="isPalga()"  class="btn btn-default" type="button"  ng-click="focus('#noteText');" title="{{'Notes' | translate}}">
                    <span><i class="glyphicon glyphicon-comment"></i></span>
                    {{'Notes' | translate}}
                </button>
                <a href="mailto:{{request.requesterEmail}}?subject=Request rejected&amp;body=Request rejected.%0AReject reason: {{request.rejectReason}}
                ">
                <button ng-if="isPalga() && request.status == 'Rejected'"
                class="btn btn-default" type="button" title="{{'Compose rejection mail' | translate}}">
                    <span><i class="glyphicon glyphicon-envelope"></i></span>
                    {{'Compose rejection mail' | translate}}
                </button></a>
                <a href="mailto:{{request.requesterEmail}}?subject=Excerpt list ready&amp;body=The excerpt list for request {{request.processInstanceId}} (&ldquo;{{request.title}}&rdquo;) is ready for download.%0ALink: {{serverurl}}/#/request/view/{{request.processInstanceId}}
                ">
                <button ng-if="isPalga() && request.status == 'DataDelivery' && request.excerptList"
                class="btn btn-default" type="button" title="{{'Compose notification mail' | translate}}">
                    <span><i class="glyphicon glyphicon-envelope"></i></span>
                    {{'Compose notification mail' | translate}}
                </button></a>
                <button ng-if="(request.status != 'Closed') && (request.status != 'Rejected') &&
                (isPalga())" ng-show="request.assignee != globals.currentUser.userid"
                class="btn btn-default" type="button"  ng-click="claim(request);" title="Claim">
                    <span><i class="glyphicon glyphicon-eye-open"></i></span>
                    {{'Claim' | translate}}
                </button>
                <button ng-if="isPalga()" ng-show="request.assignee == globals.currentUser.userid" class="btn btn-default" type="button"  ng-click="unclaim(request);" title="Claim">
                    <span><i class="glyphicon glyphicon-eye-close"></i></span>
                    {{'Unclaim' | translate}}
                </button>
                <button class="btn btn-default" type="button"  ng-click="remove(request)" title="{{'Delete' | translate}}"
                        ng-if="request.status == 'Open'">
                    <span><i class="glyphicon glyphicon-trash"></i></span>
                    {{'Delete' | translate}}
                </button>
            </div>

            <!-- Alert -->
            <div ng-repeat="alert in alerts" class="alert alert-{{alert.type}}" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close" ng-click="closeAlert();">
                    <span aria-hidden="true">&times;</span>
                </button>
                {{alert.msg | translate}}
            </div>

            <!-- Status -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Status' | translate }}</label>
                <p class="col-sm-7">
                    {{request.status}}
                    <br>
                </p>
            </div>

            <!-- Reject reason  -->
            <div class="row" ng-if="request.status == 'Rejected'">
                <label class="control-label col-sm-3">{{ 'Reject reason' | translate }}</label>
                <p class="col-sm-7">
                    {{request.rejectReason}}
                    <br>
                </p>
            </div>

            <!-- Requester -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Requester' | translate }}</label>
                <p class="col-sm-7">
                    {{request.requesterName}}
                    <br>
                </p>
            </div>
            <div class="row" ng-if="request.requester.contactData">
                <label class="control-label col-sm-3">{{ 'Contact data' | translate }}</label>
                <address  class="col-sm-7">
                     {{request.requester.contactData.address1}}
                     <br ng-if="request.requester.contactData.address1">
                     {{request.requester.contactData.address2}}
                     <br ng-if="request.requester.contactData.address2">
                     {{request.requester.contactData.postalCode}} {{request.requester.contactData.city}}
                    <span ng-if="request.requester.contactData.telephone">
                        <span><i class="glyphicon glyphicon-earphone"></i></span>
                        {{request.requester.contactData.telephone}}
                    </span>
                    <br ng-if="request.requester.contactData.telephone">
                    <span><i class="glyphicon glyphicon-envelope"></i></span>
                    <a href="mailto:{{request.requester.contactData.email}}">{{request.requester.contactData.email}}</a>
                </address>
            </div>

            <h3>{{ 'Details' | translate }}</h3>
            <hr>


            <!-- Principal Investigator -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Principal investigator' | translate }}</label>
                <p class="col-sm-7">
                    {{request.contactPersonName}}
                </p>
            </div>

            <!-- Pathologist name -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Pathologist' | translate }}</label>
                <p class="col-sm-7">
                    {{request.pathologistName}}
                </p>
            </div>

            <!-- Pathologist email -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Pathologist email' | translate }}</label>
                <p class="col-sm-7">
                    {{request.pathologistEmail}}
                </p>
            </div>




            <!-- Previous contact -->
            <div class="row">
                <label class="control-label col-sm-3">
                    {{'Previous contact'|translate}}
                </label>

                <div class="col-sm-7">
                    <span><i class="glyphicon {{request.previousContact ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                    &nbsp;{{'Previous contact'|translate}}
                    <br>
                    <span ng-if="request.previousContact"><br><em>{{ 'Previous contact' |
                    translate }}</em>:</span><span
                    ng-if="!request.previousContact">(<em>{{ 'No previous contact.' |
                    translate }}</em>)</span>
                    <div ng-if="request.previousContact">
                    {{request.previousContactDescription}}
                    <br>
                    <br>
                    </div>
                </div>
            </div>

            <!-- Title -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Title' | translate }}</label>
                <p class="col-sm-7">
                    {{request.title}}
                </p>
            </div>

            <!--Background -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Background' | translate }}</label>
                <p class="col-sm-7">
                    {{request.background}}
                </p>
            </div>

            <!-- Research Question -->
            <div class="row">
                <label class="control-label col-sm-3">{{ ' Research question' | translate }}</label>
                <p class="col-sm-7">
                    {{request.researchQuestion}}
                </p>
            </div>

            <!-- Hypothesis -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Hypothesis' | translate }}</label>
                <p class="col-sm-7">
                    {{request.hypothesis}}
                </p>
            </div>

            <!-- Methods -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Methods' | translate }}</label>
                <p class="col-sm-7">
                    {{request.methods}}
                </p>
            </div>

            <!-- Request Type -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Request type' | translate }}</label>
                <div class="col-sm-7" ng-init="">
                    {{"Request_Type_" + request.type | translate}}
                </div>
            </div>

            <!-- Billing address -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Billing address' | translate }}</label>
                <div class="col-sm-7">
                    <address>
                        {{request.billingAddress.address1}}<br>
                        {{request.billingAddress.address2}}<br>
                        {{request.billingAddress.postalCode}}<br>
                        {{request.billingAddress.city}}<br>
                        {{request.billingAddress.email}}<br>
                        {{request.billingAddress.telephone}}
                    </address>
                </div>
            </div>

            <!-- Charge number -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Charge number' | translate }}</label>
                <p class="col-sm-7">
                    {{request.chargeNumber}}
                </p>
            </div>

            <!-- Research number -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Research number' | translate }}</label>
                <p class="col-sm-7">
                    {{request.researchNumber}}
                </p>
            </div>


            <!-- Data Linkage -->
            <div class="row" ng-show="request.type != '1'">
                <label class="control-label col-sm-3">
                    &nbsp;
                </label>

                <div class="col-sm-7">
                    <span><i class="glyphicon {{request.linkageWithPersonalData ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                    &nbsp;{{'Data linkage'|translate}}
                    <br>
                    (<em><span ng-if="request.linkageWithPersonalData">{{ 'Linkage with own or external personal data.' |
                    translate }}</span><span
                    ng-if="!request.linkageWithPersonalData">{{ 'No data linkage required.' |
                    translate }}</span></em>)
                </div>
            </div>

            <!-- Informed Consent -->
            <div class="row" ng-show="request.type != '1'">
                <label class="control-label col-sm-3">
                    &nbsp;
                </label>

                <div class="col-sm-7">
                    <span><i class="glyphicon {{request.informedConsent ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                    &nbsp; {{ 'Informed consent.' |
                    translate }}
                </div>
            </div>

            <!-- Reason Using Personal Data -->
            <div class="row" ng-show="request.type != '1'">
                <label class="control-label col-sm-3">{{ 'Reason using personal data' | translate }}</label>
                <p class="col-sm-7">
                    {{request.reasonUsingPersonalData}}
                </p>
            </div>

            <br>

            <h3>{{ 'Attachments' | translate }}</h3>
            <hr>

            <div ng-show="request.attachments.length < 1"><p><i>{{'No attachment found.' | translate}}</i></p></div>

            <ul class="list-group" id="attachments">
                <li class="list-group-item" ng-repeat="file in request.attachments">
                    <label><a ng-href="/requests/{{request.processInstanceId}}/files/{{file.id}}">{{file.name}}</a></label>
                </li>
            </ul>

            <h3>{{ 'Medical ethical committee approval' | translate }}</h3>
            <hr>

            <div ng-show="request.medicalEthicalCommitteeApprovalAttachments.length < 1"><p><i>{{'No attachment found.' | translate}}</i></p></div>

            <ul class="list-group" id="medicalEthicalCommitteeApprovalAttachments">
                <li class="list-group-item" ng-repeat="file in request.medicalEthicalCommitteeApprovalAttachments">
                    <label><a ng-href="/requests/{{request.processInstanceId}}/files/{{file.id}}">{{file.name}}</a></label>
                </li>
            </ul>


            <div ng-if="request.status=='Review' && isPalga()">
                <br>

                <h3>{{'Checks by Palga'|translate}}</h3>
                <hr>

                <!-- Requester valid -->
                <div class="row">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-7">
                        <span><i class="glyphicon {{request.requesterValid ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                        &nbsp; {{ 'The requester has been checked and is valid.' | translate }}
                    </div>
                </div>

                <!-- Lab -->
                <div class="row">
                    <br>
                    <label class="control-label col-sm-3">
                       {{'Lab' | translate}}
                    </label>
                    <div class="col-sm-7">
                        <span ng-if="request.lab.number">{{request.lab.number}} {{request.lab.name}}</span>
                        <div ng-if="!request.lab.number" class="alert alert-warning"><em>{{'No lab selected.'|translate}}</em></div>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-7">
                        <span><i class="glyphicon {{request.requesterLabValid ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                        &nbsp; {{ 'The requester has been confirmed to be associated with the lab.' | translate }}
                    </div>
                </div>

                <!-- Requester allowed -->
                <div class="row">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-7">
                        <span><i class="glyphicon {{request.requesterAllowed ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                        &nbsp; {{ 'The requester is allowed to file the request.' | translate }}
                    </div>
                </div>

                <!-- Contact person allowed -->
                <div class="row">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-7">
                        <span><i class="glyphicon {{request.contactPersonAllowed ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                        &nbsp; {{ 'The contact person been checked and is authorised to support the request.' | translate }}
                    </div>
                </div>

                <h3>{{'Signed agreement'|translate}}</h3>
                <hr>

                <!-- Agreement reached -->
                <div class="row">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-7">
                        <span><i class="glyphicon {{request.agreementReached ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                        &nbsp; {{ 'Agreement has been reached.' | translate }}
                    </div>
                </div>

                <ul class="list-group">
                    <li class="list-group-item" ng-repeat="file in request.agreementAttachments">
                        <label><a ng-href="/requests/{{request.processInstanceId}}/files/{{file.id}}">{{file.name}}</a></label>
                    </li>
                </ul>

                <br>

            </div>


            <div ng-if="request.status=='Approval' && isPalga()">

                <!--*****************-->
                <!--Privacy Committee-->
                <!--*****************-->
                <br>

                <h3>{{'Privacy committee checks'|translate}}</h3>
                <hr>

                <!-- Has this request has been sent to Privacy Committee -->
                <div class="row">
                    <label class="control-label col-sm-3">
                        &nbsp;
                    </label>
                    <div class="col-sm-7">
                        <span><i class="glyphicon {{request.sentToPrivacyComm ? 'glyphicon-check' : 'glyphicon-unchecked'}}"></i></span>
                        &nbsp; {{ 'This request has been sent to privacy committee to be checked.' | translate }}
                    </div>
                </div>

                <!-- Outcome -->
                <div class="row">
                    <label class="control-label col-sm-3">{{ 'Outcome' | translate }}</label>
                    <p class="col-sm-7">
                        {{request.privacyCommitteeOutcome}}
                    </p>
                </div>

                <!-- Outcome Reference -->
                <div class="row">
                    <label class="control-label col-sm-3">{{ 'Outcome reference' | translate }}</label>
                    <p class="col-sm-7">
                        {{request.privacyCommitteeOutcomeRef}}
                    </p>
                </div>

                <!-- Outcome Emails -->
                <div class="row">
                    <label class="control-label col-sm-3">{{ 'Emailing history' | translate }}</label>
                    <p class="col-sm-7">
                        {{request.privacyCommitteeEmails}}
                    </p>
                </div>

                <br>

                </div>

            <!--Approvals-->
            <div ng-include="'app/request/approvals.html'"
                 ng-if="(request.status=='Approval' || request.approvalVotes != null) &&
                         ( isPalga() || isScientificCouncil() )"></div>
            <!--Comments-->
            <div ng-include="'app/request/comments.html'" ng-if="isPalga()"></div>

            <!--Upload Files if in 'DataDelivery' status-->
            <div ng-include="'app/request/upload-file.html'" 
                ng-if="request.status=='DataDelivery' || request.status=='SelectionReview' || request.status=='LabRequest' || request.status=='Closed'"></div>

            <div ng-if="request.status == 'LabRequest'">

            <h3>{{ 'Lab request details' | translate }}</h3>
            <hr>

            <!-- Excerpt list remark -->
            <div class="row">
                <label class="control-label col-sm-3">{{ 'Remark' | translate }}</label>
                <p class="col-sm-7">
                    {{request.excerptListRemark}}
                </p>
            </div>

            </div> <!-- endif LabRequest -->


        </div>

    </div> <!--end row-->
</div>
<br>
<br>
