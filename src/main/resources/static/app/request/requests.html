<div class="container-fluid">
    <div class="row" ng-controller="RequestController">

        <!--Side Bar-->
        <div class="col-sm-3 col-md-2 sidebar">
            <div>
                <dntp-sidebar all-requests="allRequests" />
            </div>
        </div>

        <div ng-if="!authenticated">
            <div class="alert alert-danger" role="alert">
                {{ 'Not logged in' | translate }}
            </div>
        </div>

        <!--Main Content-->
        <div ng-if="authenticated" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

            <div ng-show="error" class="alert alert-danger" role="alert">
                {{ error | translate }}
            </div>

            <h1>{{ 'Requests' | translate }}</h1>
            <hr>
            <!--Tool bar-->
          <ul class="nav nav-pills" ng-if="isRequester()">
            <li role="presentation" title="Create a new request">
                <button class="btn btn-default"  ng-click="start()" id="new-request">
                    <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                    {{'Create new request'|translate}}
                </button>
            </li>
            <li ng-if="loadTestEnabled()">
                <span class="btn btn-warning" ng-click="loadTest()">Load test</span>
            </li>
            </ul>
            <ul class="nav nav-pills" ng-if="isPalga() && loadTestEnabled()">
                <li>
                    <span class="btn btn-warning" ng-click="loadTestPalga()">Load test Palga</span>
                </li>
            </ul>

            <!--List of request-->
            <div class="table-responsive" ng-if="authenticated">
                <table st-table="displayedCollection" st-safe-src="requests" class="table">
                <!-- <table st-table="displayedCollection | filter:filterEmptyRequests" st-safe-src="requests" class="table"> -->
                    <thead>
                    <tr>
                        <th st-sort="number" style="width: 6em">#</th>
                        <th st-sort="title">{{'Title'|translate}}</th>
                        <th st-sort="status">{{'Status'|translate}}</th>
                        <th st-sort="dateCreated">{{'Creation date'|translate}}</th>
                        <th ng-if="globals.currentUser.roles.indexOf('scientific_council') != -1" st-sort="vote">{{'Vote'|translate}}</th>
                        <th ng-if="globals.currentUser.roles.indexOf('palga') != -1"  st-sort="requesterName">{{'Requester'|translate}}</th>
                        <th ng-if="globals.currentUser.roles.indexOf('palga') != -1" st-sort="assigneeName">{{'Assignee'|translate}}</th>
                        <th ng-if="globals.currentUser.roles.indexOf('palga') != -1" st-sort="dateAssigned">{{'Date assigned'|translate}}</th>
                        <th style="width: 14em">{{'Actions'|translate}}</th>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <th><input st-search="title" placeholder="{{'Filter by title'|translate}}" class="input-sm form-control" type="search"/></th>
                        <th><input st-search="status" placeholder="{{'Filter by status'|translate}}" class="input-sm form-control" type="search"/></th>
                        <th>&nbsp;</th>
                        <th class="request-vote" ng-if="globals.currentUser.roles.indexOf('scientific_council') != -1">&nbsp;</th>
                        <th ng-if="globals.currentUser.roles.indexOf('palga') != -1"><input st-search="requesterName" placeholder="{{'Filter by requester'|translate}}" class="input-sm form-control" type="search"/></th>
                        <th ng-if="globals.currentUser.roles.indexOf('palga') != -1"><input st-search="assigneeName" placeholder="{{'Filter by assignee'|translate}}" class="input-sm form-control" type="search"/></th>
                        <th ng-if="globals.currentUser.roles.indexOf('palga') != -1">&nbsp;</th>
                        <th>&nbsp;</th>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <th colspan="6"><input id="request-search" st-search="" class="form-control" placeholder="{{'Search'|translate}} ..." type="text"/></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="req in displayedCollection" id="request_{{req.id}}" ng-class="{'smart-table-selected': req.assignee == globals.currentUser.userid}">
                        <td>{{req.requestNumber}}</td>
                        <td><a ng-href="/#/request/view/{{req.processInstanceId}}">{{req.title}}</a></td>
                        <td class="request-status">{{req.status | translate}}
                            <span class="badge" ng-if="req.status=='Approval' && globals.currentUser.roles.indexOf('palga') != -1" >
                            {{req.numberOfApprovalVotes ? req.numberOfApprovalVotes : 0 }}
                            </span>                        
                        </td>
                        <td><small>{{req.dateCreated | date: 'EEE dd MMMM yyyy'}}</small></td>
                        <td ng-if="globals.currentUser.roles.indexOf('scientific_council') != -1" class="request-vote">
                            {{req.approvalVote}}
                        </td>
                        <td ng-if="globals.currentUser.roles.indexOf('palga') != -1" >{{req.requesterName}}</td>
                        <td ng-if="globals.currentUser.roles.indexOf('palga') != -1" >{{req.assigneeName == '' ? req.assignee : req.assigneeName}}</td>
                        <td ng-if="globals.currentUser.roles.indexOf('palga') != -1" >
                            <small>{{req.dateAssigned | date: 'EEE dd MMMM yyyy  H:mm'}}</small>
                        </td>
                        <td>
                        <span class="pull-right">
                        <span class="btn-group">
                            <button
                                ng-if="globals.currentUser.roles.indexOf('requester') != -1 || globals.currentUser.roles.indexOf('palga') != -1"
                                 ng-disabled="(globals.currentUser.roles.indexOf('requester') != -1 && req.status != 'Open')
                                    || !(req.status == 'Open' || req.status == 'Review' || req.status == 'Approval')
                                    || (globals.currentUser.roles.indexOf('palga') != -1 && req.assignee != globals.currentUser.userid)"
                                 class="btn btn-default" type="button" title="{{'Edit'|translate}}" ng-click="edit(req)">
                                <span><i class="glyphicon glyphicon-pencil"></i></span>
                            </button>
                            <button ng-if="globals.currentUser.roles.indexOf('palga') != -1" 
                                ng-disabled="req.assignee == globals.currentUser.userid || !(req.status == 'Open' || req.status == 'Review' || req.status == 'Approval' || req.status == 'DataDelivery' || req.status == 'SelectionReview')"
                                 class="btn btn-default" type="button" title="{{'Claim'|translate}}" ng-click="claim(req)">
                                <span><i class="glyphicon glyphicon-eye-open"></i></span>
                            </button>
                            <button ng-if="globals.currentUser.roles.indexOf('palga') != -1" 
                                ng-disabled="req.assignee != globals.currentUser.userid || !(req.status == 'Open' || req.status == 'Review' || req.status == 'Approval' || req.status == 'DataDelivery' || req.status == 'SelectionReview')"
                                 class="btn btn-default" type="button" title="{{'Unclaim'|translate}}" ng-click="unclaim(req)">
                                <span><i class="glyphicon glyphicon-eye-close"></i></span>
                            </button>
                            <button
                                 ng-if="req.status == 'Open'"
                                 class="btn btn-default" type="button" title="{{'Delete'|translate}}" ng-click="remove(req)">
                                <span><i class="glyphicon glyphicon-trash"></i></span>
                            </button>
                            <button
                                 ng-if="globals.currentUser.roles.indexOf('palga') != -1 && req.reviewStatus != 'SUSPENDED'"
                                 ng-disabled="req.assignee != globals.currentUser.userid"
                                 class="btn btn-default" type="button" title="{{'Suspend'|translate}}" ng-click="suspend(req)">
                                <span><i class="glyphicon glyphicon-pause"></i></span>
                            </button>
                            <button
                                 ng-if="globals.currentUser.roles.indexOf('palga') != -1 && req.reviewStatus == 'SUSPENDED'"
                                 ng-disabled="req.assignee != globals.currentUser.userid"
                                 class="btn btn-default" type="button" title="{{'Resume'|translate}}" ng-click="resume(req)">
                                <span><i class="glyphicon glyphicon-play"></i></span>
                            </button>
                        </span>
                        </span>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="8" class="text-center">
                                <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <!--=====================================================-->
            <!--TODO: To reuse table just change the result instance -->
            <!--=====================================================-->

        </div> <!--end Main Content-->

    </div>
</div>
